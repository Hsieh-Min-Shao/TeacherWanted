<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- bootstrap相關 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
      crossorigin="anonymous"
    ></script>
    <!-- bootstrap相關 -->

    <link href="../css/baseVer2.css" rel="stylesheet" type="text/css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <script src="../jquery/jquery-3.6.4.min.js"></script>
    <script src="../js/base.js"></script>

    <title>Document</title>
    <style>
      .truncate-text {
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 3; /* 顯示3行 */
        -webkit-box-orient: vertical;
        line-height: 1.5em; /* 行高 */
      }

      .show-more {
        display: none;
      }

      .show-all .truncate-text {
        -webkit-line-clamp: unset; /* 取消行數限制 */
      }

      .show-all .show-more {
        display: none;
      }
    </style>
  </head>
  <body class="TeacherWanted">
    <!-- 手機板導引列(粗糙) -->
    <header class="TeacherWanted">
      <div id="mySidebar">
        <img src="../img/base/logo.png" alt="" />
        <a href="#" class="">首頁</a>
        <a href="#" class="">課程</a>
        <a href="#" class="">活動</a>
        <a href="#" class="">許願池</a>
        <a href="#" class="">論壇</a>
        <a href="#" class="">商城</a>
      </div>
      <div class="navBar">
        <ul class="containerHearder flexWrap flexVerticalCenter">
          <li>
            <img
              src="../img/base/menu.png"
              id="phoneMenu"
              class="mobileHave"
              style="height: 30px; margin: 10px"
              alt=""
            />
          </li>

          <li
            class="flexWrap flexAllCenter"
            style="font-size: 50px; color: #a4c964; margin: 10px 0px"
          >
            <img
              src="../img/base/logo.png"
              class="miniMobile"
              style="height: 50px; margin: 0px 5px"
              alt=""
            />
            <p>懸賞啼雀</p>
          </li>
          <li
            class="flexWrap"
            style="
              flex-grow: 1;
              display: flex;
              align-items: center;
              justify-content: end;
            "
          >
            <!-- 電腦版導引列 -->
            <div
              id="navLink"
              class="flexWrap flexAllCenter pcHave"
              style="flex-grow: 1"
            >
              <a class="flexAllCenter" href="">首頁</a>
              <a class="flexAllCenter" href="">課程</a>
              <a class="flexAllCenter" href="">活動</a>
              <a class="flexAllCenter" href="">許願池</a>
              <a class="flexAllCenter" href="">論壇</a>
              <a class="flexAllCenter" href="">商城</a>
            </div>
            <div
              class="flexWrap flexAllCenter"
              style="position: relative; top: 2px"
            >
              <div class="miniMobile">
                <form id="navSearch" action="">
                  <select>
                    <option>課程</option>
                    <option>活動</option>
                    <option>商城</option>
                    <option>許願</option>
                  </select>
                  <input type="text" />
                  <img src="../img/base/search.svg" alt="" />
                </form>
              </div>
              <img
                src="../img//base/mailForNavbar.svg"
                class="miniMobile"
                style="
                  height: 30px;
                  margin: 3px 5px;
                  cursor: pointer;
                  position: relative;
                  bottom: 1px;
                "
                alt=""
              />
              <img
                src="../img/base/shoppingCart.svg"
                class="miniMobile"
                style="height: 30px; margin: 3px 5px; cursor: pointer"
                alt=""
              />
              <img
                src="../img/base/bell.svg"
                class="miniMobile"
                style="height: 30px; margin: 3px 5px; cursor: pointer"
                alt=""
              />

              <a class="btnCss flexAllCenter" style="color: white" href=""
                >登入</a
              >
            </div>
          </li>
        </ul>
      </div>
    </header>

    <main class="TeacherWanted">
      <!-- ！！！寫在這裡！！！
      如果要讓區塊至中的話可以使用containerBase這個class(目前寬度1140px) -->

      <!-- ==================================(上)發表文章/發文紀錄/我的收藏/搜尋================================================= -->
      <!-- 發表文章/發文紀錄/我的收藏/搜尋 -->
      <div class="container-fluid">
        <nav class="navbar">
          <div class="container-fluid">
            <div class="col-md">
              <button
                type="button"
                class="btn btn-outline-success bbs_btn_edit"
              >
                發表文章
              </button>
            </div>
            <div class="col-md">
              <button
                type="button"
                class="btn btn-outline-success bbs_btn_view"
              >
                發文紀錄
              </button>
            </div>
            <div class="col-md-7">
              <button
                type="button"
                class="btn btn-outline-success bbs_btn_favorite"
              >
                我的收藏
              </button>
            </div>
            <form class="d-flex col-md-3">
              <input
                class="form-control me-md-2"
                type="search"
                placeholder="查詢文章請輸入..."
                aria-label="Search"
              />
              <button class="btn btn-outline-success" type="submit">
                Search
              </button>
            </form>
          </div>
        </nav>
      </div>
      <!-- =====================================(下)======================================================== -->
      <div class="row g-3">
        <!-- =====================================(下左)側邊欄======================================================== -->
        <div class="col-md-2 mt-3">
          <!-- 側邊攔 -->
          <div class="list-group" id="list-tab" role="tablist">
            <a
              class="list-group-item list-group-item-action bbs_kb_lg"
              data-bs-toggle="list"
              href="#"
              role="tab"
              aria-controls="list-profile"
              data-value="1"
              >語言討論版</a
            >
            <a
              class="list-group-item list-group-item-action bbs_kb_pg"
              data-bs-toggle="list"
              href="#"
              role="tab"
              aria-controls="list-messages"
              data-value="2"
              >程式討論版</a
            >
            <a
              class="list-group-item list-group-item-action bbs_kb_lf"
              data-bs-toggle="list"
              href="#"
              role="tab"
              aria-controls="list-settings"
              data-value="3"
              >生活討論版</a
            >
            <a
              class="list-group-item list-group-item-action bbs_kb_gm"
              data-bs-toggle="list"
              href="#"
              role="tab"
              aria-controls="list-settings"
              data-value="4"
              >電競討論版</a
            >
          </div>
        </div>
        <!-- =====================================(下右)一篇發文資訊======================================================= -->
        <div class="col-md-6 bbs_index_group mx-lg-5">
          <!-- =================================開始複製大頭貼/發文者名稱/看版標籤======================================== -->
          <!-- bbs_index_html -->

          <!-- =================================結束複製大頭貼/發文者名稱/看版標籤======================================== -->
        </div>
      </div>
    </main>

    <footer
      class="TeacherWanted"
      style="background-color: #3c6a36; color: white"
    >
      <div
        class="containerFooter flexAllCenter"
        style="box-sizing: border-box; padding-top: 50px"
      >
        <div class="flexWrap">
          <ul class="col_33">
            <li class="flexAllCenter" style="color: #a4c964; font-size: 40px">
              懸賞啼雀
            </li>
            <li
              class="flexAllCenter"
              style="margin: 10px 30px; font-weight: normal"
            >
              Labore dolor amet ipsum ea, erat sit ipsum duo eos. Volup amet ea
              dolor et magna dolor, elitr rebum duo est sed diam elitr. Stet
              elitr stet diam duo eos rebum ipsum diam ipsum elitr.
            </li>
            <li
              id="imgIcon"
              class="flexVerticalCenter"
              style="margin: 20px 30px"
            >
              <img src="../img/base/facebook.svg" class="imgIntroduce" alt="" />
              <img src="../img/base/twitter.svg" class="imgIntroduce" alt="" />
              <img
                src="../img/base/instagram.svg"
                class="imgIntroduce"
                alt=""
              />
            </li>
          </ul>
          <ul class="col_33 flexHorizontalCenter footerMobile">
            <div style="width: 70%">
              <li
                class="flexAllCenter"
                style="color: #a4c964; font-size: 30px; height: 65px"
              >
                Get In Touch
              </li>
              <div class="" style="height: 250px; font-weight: 400">
                <li class="flexWrap" style="margin-top: 10px">
                  <img
                    src="../img/base/map-marker.svg"
                    style="height: 24px; padding-right: 10px; margin-top: 6px"
                    alt=""
                  />
                  <div>
                    <h3 style="font-size: 1.3rem">地址</h3>
                    <h5 style="font-size: 1rem">123</h5>
                  </div>
                </li>

                <li class="flexWrap" style="margin-top: 10px">
                  <img
                    src="../img/base/mail.svg"
                    style="height: 24px; padding-right: 10px; margin-top: 6px"
                    alt=""
                  />
                  <div>
                    <h3 style="font-size: 1.3rem">信箱</h3>
                    <h5 style="font-size: 1rem">a1234567890@gmail.com</h5>
                  </div>
                </li>

                <li class="flexWrap" style="margin-top: 10px">
                  <img
                    src="../img/base/phone.svg"
                    style="height: 24px; padding-right: 10px; margin-top: 6px"
                    alt=""
                  />
                  <div>
                    <h3 style="font-size: 1.3rem">連絡電話</h3>
                    <h5 style="font-size: 1rem">0900123456</h5>
                  </div>
                </li>
              </div>
            </div>
          </ul>
          <ul class="col_33 flexHorizontalCenter footerMobile">
            <div style="width: 40%">
              <li
                class="flexAllCenter"
                style="color: #a4c964; font-size: 30px; height: 65px"
              >
                網站地圖
              </li>
              <div class="webMap">
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="">>首頁</a>
                </li>
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="">>課程</a>
                </li>
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="">>活動</a>
                </li>
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="">>許願池</a>
                </li>
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="">>論壇</a>
                </li>
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="">>商城</a>
                </li>
              </div>
            </div>
          </ul>
        </div>
      </div>
    </footer>

    <script>
      // ===================================畫面一載入=====================================================================
      $.ajax({
        url: "/bbsdiscussGet",
        type: "GET",
        data: {},
        dataType: "json",
        success: function (data) {
          // $.ajax({
          //   url: "/bbsdiscussGet/edit/memberInfo", // 第二个请求的地址
          //   type: "GET",
          //   data: {},
          //   dataType: "json",
          //   success: function (data2) {

          //   }
          // })
          // console.log(data);

          // 使用迴圈遍歷資料陣列
          for (let i = 0; i < data.length; i++) {
            $.ajax({
              url: "/bbsdiscussGetAll", // 資料請求的網址
              type: "GET", // GET | POST | PUT | DELETE | PATCH
              data: { bbsPostId: data[i].bbsPostId },
              dataType: "json",
              beforeSend: function () {},
              success: function (data2) {
                console.log(data);
                console.log(data2);
                // 獲取每個資料項目的相關屬性值
                let bbsPostId = data[i].bbsPostId;
                let postTitle = data[i].postTitle;
                let postContent = data[i].postContent;
                let bbsCategoryName = data[i].bbsCategoryName;
                let bbsTagName = data[i].bbsTagName;
                let memId = data[i].memId;
                let updateTime = data[i].updateTime;
                let postDislikes = data[i].postDislikes;
                let postLikes = data[i].postLikes;
                let postStatus = data[i].postStatus;
                let elapsedTime = getElapsedTime(updateTime);
                let memPhoto =
                  "data:image/" + "null" + ";base64," + data2.memPhoto;
                let favStatus = data2.favStatus;
                let reaction_status = data2.reaction_status;
                let memAccount = data2.memAccount;
                let memName = data2.memName;
                console.log(memName);
                let bbs_index_html = `
                <div class="card mt-3 mb-3">
                  <div
                    class="card-header row"
                    style="margin-left: 0; margin-right: 0"
                  >
                    <!-- 大頭貼 -->
                    <div class="col-md-2">
                      <img
                        src="${memPhoto}"
                        alt="頭貼"
                        style="width: 60px; height: auto"
                      />
                    </div>
                    <!-- 發文者名稱/看版標籤 -->
                    <div class="col-md-10">
                      <div class="bbs_index_name text-black-50">${memName}</div>
                      <div
                        class="bbs_index_kanban badge bg-info text-white text-dark"
                      >
                        ${bbsCategoryName}
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <h5 class="card-title text-center mb-3">
                      ${postTitle}
                    </h5>
                    <p class="card-text truncate-text" id="postContent_${bbsPostId}">
                      ${postContent}
                    </p>
                    <div class="show-more row justify-content-end mb-3" data-postid="${bbsPostId}">
                      <button class="btn btn-primary mt-3">查看完整文章</button>
                    </div>
                    <a
                      href="#"
                      class="btn border-primary text-dark col-md-1 bbs_click_up"
                      ><span
                        ><img
                          src="../img/bbsdiscuss/thumbs-up-regular.svg"
                          alt="讚"
                          style="width: 20px"
                          ;
                          height="10px"
                        />
                        <h6>${reaction_status}-${postLikes}</h6></span
                      >
                    </a>
                    <a href="#" class="btn border-danger col-md-1 bbs_click_heart"
                      ><span
                        ><img
                          src="../img/bbsdiscuss/heart-regular.svg"
                          alt=""
                          style="width: 20px"
                          ;
                          height="10px"
                        />
                        <h6>${favStatus}</h6>
                      </span>
                    </a>
                  </div>
                  <div class="text-center card-footer text-muted">${elapsedTime}</div>
                </div>
                `;
                $(".bbs_index_group").append(bbs_index_html);
                // =============================================查看完整文章===================================================
                $(".show-more").on("click", function () {
                  let postId = $(this).data("postid");
                  window.location.href = `post.html?bbsPostId=${postId}`;
                });

                // console.log(memId);
                // 使用迴圈遍歷每篇文章的内容，根據內容長度顯示或隱藏“查看完整文章”按鈕
                $(".card-text").each(function () {
                  let textLength = $(this).text().length;
                  // console.log(textLength);
                  let postId = $(this).attr("id").split("_")[1];
                  let $showMoreButton = $(this).siblings(
                    `.show-more[data-postid="${postId}"]`
                  );
                  $showMoreButton.show();
                });
              },
            });
          }
        },
      });
      // ======================================看板================================================
      $(function () {
        $(".list-group-item").on("click", function () {
          // var value = $(this).data("value");
          var text = $(this).text();
          console.log(text);
          var url;

          if ($(this).hasClass("bbs_kb_lg")) {
            url = "/bbsdiscussGet/lg";
          } else if ($(this).hasClass("bbs_kb_pg")) {
            url = "/bbsdiscussGet/lg";
          } else if ($(this).hasClass("bbs_kb_lf")) {
            url = "/bbsdiscussGet/lg";
          } else if ($(this).hasClass("bbs_kb_gm")) {
            url = "/bbsdiscussGet/lg";
          }

          $.ajax({
            url: url + "/" + text,
            type: "GET",
            data: {},
            dataType: "json",
            success: function (data) {
              console.log("有嗎");
              console.log(data);
              $(".bbs_index_group").empty();
              // 使用迴圈遍歷資料陣列
              for (let i = 0; i < data.length; i++) {
                $.ajax({
                  url: "/bbsdiscussGetAll", // 資料請求的網址
                  type: "GET", // GET | POST | PUT | DELETE | PATCH
                  data: { bbsPostId: data[i].bbsPostId },
                  dataType: "json",
                  beforeSend: function () {},
                  success: function (data2) {
                    console.log(data);
                    console.log(data2);
                    // 獲取每個資料項目的相關屬性值
                    let bbsPostId = data[i].bbsPostId;
                    let postTitle = data[i].postTitle;
                    let postContent = data[i].postContent;
                    let bbsCategoryName = data[i].bbsCategoryName;
                    let bbsTagName = data[i].bbsTagName;
                    let memId = data[i].memId;
                    let updateTime = data[i].updateTime;
                    let postDislikes = data[i].postDislikes;
                    let postLikes = data[i].postLikes;
                    let postStatus = data[i].postStatus;
                    let elapsedTime = getElapsedTime(updateTime);
                    let memPhoto =
                      "data:image/" + "null" + ";base64," + data2.memPhoto;
                    let favStatus = data2.favStatus;
                    let reaction_status = data2.reaction_status;
                    let memAccount = data2.memAccount;
                    let memName = data2.memName;
                    console.log(memName);
                    let bbs_index_html = `
                <div class="card mt-3 mb-3">
                  <div
                    class="card-header row"
                    style="margin-left: 0; margin-right: 0"
                  >
                    <!-- 大頭貼 -->
                    <div class="col-md-2">
                      <img
                        src="${memPhoto}"
                        alt="頭貼"
                        style="width: 60px; height: auto"
                      />
                    </div>
                    <!-- 發文者名稱/看版標籤 -->
                    <div class="col-md-10">
                      <div class="bbs_index_name text-black-50">${memName}</div>
                      <div
                        class="bbs_index_kanban badge bg-info text-white text-dark"
                      >
                        ${bbsCategoryName}
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <h5 class="card-title text-center mb-3">
                      ${postTitle}
                    </h5>
                    <p class="card-text truncate-text" id="postContent_${bbsPostId}">
                      ${postContent}
                    </p>
                    <div class="show-more row justify-content-end mb-3" data-postid="${bbsPostId}">
                      <button class="btn btn-primary mt-3">查看完整文章</button>
                    </div>
                    <a
                      href="#"
                      class="btn border-primary text-dark col-md-1 bbs_click_up"
                      ><span
                        ><img
                          src="../img/bbsdiscuss/thumbs-up-regular.svg"
                          alt="讚"
                          style="width: 20px"
                          ;
                          height="10px"
                        />
                        <h6>${reaction_status}${postLikes}</h6></span
                      >
                    </a>
                    <a href="#" class="btn border-danger col-md-1 bbs_click_heart"
                      ><span
                        ><img
                          src="../img/bbsdiscuss/heart-regular.svg"
                          alt=""
                          style="width: 20px"
                          ;
                          height="10px"
                        />
                        <h6>${reaction_status}</h6>
                      </span>
                    </a>
                  </div>
                  <div class="text-center card-footer text-muted">${elapsedTime}</div>
                </div>
                `;
                    $(".bbs_index_group").append(bbs_index_html);
                    // =============================================查看完整文章===================================================
                    $(".show-more").on("click", function () {
                      let postId = $(this).data("postid");
                      window.location.href = `post.html?bbsPostId=${postId}`;
                    });

                    // console.log(memId);
                    // 使用迴圈遍歷每篇文章的内容，根據內容長度顯示或隱藏“查看完整文章”按鈕
                    $(".card-text").each(function () {
                      let textLength = $(this).text().length;
                      // console.log(textLength);
                      let postId = $(this).attr("id").split("_")[1];
                      let $showMoreButton = $(this).siblings(
                        `.show-more[data-postid="${postId}"]`
                      );
                      $showMoreButton.show();
                    });
                  },
                });
              }
            },
            error: function (error) {
              // 处理错误响应
            },
          });
        });
      });

      // ===================================================顯示幾天前===================================================
      function getElapsedTime(updateTime) {
        const currentDate = new Date();
        const updatedDate = new Date(updateTime);

        const timeDiff = Math.abs(currentDate - updatedDate);
        const daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
        const hoursDiff = Math.floor(timeDiff / (1000 * 60 * 60)) % 24;

        if (daysDiff === 0) {
          if (hoursDiff > 0) {
            return `${hoursDiff} 小時前`;
          } else {
            return "今天";
          }
        } else if (daysDiff === 1) {
          if (hoursDiff > 0) {
            return `1 天前`;
          } else {
            return "昨天";
          }
        } else {
          return `${daysDiff} 天前`;
        }
      }

      $(function () {
        // ============================按讚======================================================================
        let bbs_post_up = 20;
        $("a.bbs_click_up").on("click", function (e) {
          // console.log("aaa");
          e.preventDefault();
          let img_element = $("a.bbs_click_up img");
          let current_src = img_element.attr("src");
          let solid_src = "img/bbsdiscuss/thumbs-up-solid.svg";
          let regular_src = "img/bbsdiscuss/thumbs-up-regular.svg";

          if (current_src === regular_src) {
            img_element.attr("src", solid_src);
            bbs_post_up++; // 讚的數量加1
            console.log(bbs_post_up);
            $("a.bbs_click_up").addClass("btn-primary text-white");
          } else if (current_src === solid_src) {
            img_element.attr("src", regular_src);
            bbs_post_up--; // 讚的數量减1
            console.log(bbs_post_up);
            $("a.bbs_click_up").removeClass("btn-primary text-white");
          }
          // 更新讚的數量
          $(this).find("h6").text(bbs_post_up);
        });

        // ============================倒讚======================================================================
        let bbs_post_heart = 10;
        $("a.bbs_click_heart").on("click", function (e) {
          // console.log("aaa");
          e.preventDefault();
          let img_element = $("a.bbs_click_heart img");
          let current_src = img_element.attr("src");
          let solid_src = "img/bbsdiscuss/heart-solid.svg";
          let regular_src = "img/bbsdiscuss/heart-regular.svg";

          if (current_src === regular_src) {
            img_element.attr("src", solid_src);
            bbs_post_heart++; // 讚的數量加1
            console.log(bbs_post_heart);
            $("a.bbs_click_heart").addClass("btn-danger text-white");
          } else if (current_src === solid_src) {
            img_element.attr("src", regular_src);
            bbs_post_heart--; // 讚的數量减1
            console.log(bbs_post_heart);
            $("a.bbs_click_heart").removeClass("btn-danger text-white");
          }
          // 更新讚的數量
          $(this).find("h6").text(bbs_post_heart);
        });
        // ============================跳轉到發表文章======================================================================

        $(".bbs_btn_edit").on("click", function () {
          window.location.href = "edit.html";
        });
        // ============================跳轉到發文紀錄======================================================================

        $(".bbs_btn_view").on("click", function () {
          window.location.href = "po.html";
        });
        // ============================跳轉到我的收藏======================================================================

        $(".bbs_btn_favorite").on("click", function () {
          window.location.href = "heart.html";
        });
      });
    </script>
  </body>
</html>
