<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- bootstrap相關 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
      crossorigin="anonymous"
    ></script>
    <!-- bootstrap相關 -->
    <link href="../css/basebbs.css" rel="stylesheet" type="text/css" />
    <link href="../css/active/active.css" rel="stylesheet" type="text/css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="docs/images/favicon.ico"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
      integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
      integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
      crossorigin=""
    ></script>
    <!-- jquery套件 -->
    <script src="../jquery/jquery-3.6.4.min.js"></script>
    <!-- axios套件 -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> -->
    <script src="../axios/axios.js"></script>
    <!-- vue3套件 -->
    <!-- <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script> -->
    <script src="../vue/vue-3.3.4.js"></script>
    <!-- 要登入驗證請解開這個 -->
    <!-- <script src="../js/loginCheck.js"></script> -->
    <!-- js匯入 -->
    <script src="../js/base.js"></script>
    <script src="../js/active/active.js"></script>

    <title>Document</title>
    <style>
      .comment.hidden {
        display: none;
      }

      .bbs_show_part.hidden {
        display: none;
      }

      .bbs_show_more_link {
        color: blue;
        text-decoration: underline;
        cursor: pointer;
      }

      ul.bbs_comment_list li {
        border-top: 1px solid #ccc;
      }

      .bbs_show_part + .comment:not(:last-child) {
        border-top: none;
      }

      input.task_name_update {
        width: 100%;
        border: 1px solid lightgray;
        border-radius: 3px 0 0 3px;
        height: 40px;
        font-size: 2rem;
        padding: 5px 10px;
        outline: none;
      }

      input.task_name_update::placeholder {
        color: lightgray;
      }

      .-none {
        display: none;
      }

      input.post_title_update {
        width: 80%;
        border: 1px solid lightgray;
        border-radius: 3px 0 0 3px;
        height: 40px;
        font-size: 2rem;
        padding: 5px 10px;
        outline: none;
      }

      textarea.post_content_update {
        width: 100%;
        border: 1px solid lightgray;
        border-radius: 3px 0 0 3px;
        height: 200px;
        font-size: 2rem;
        padding: 5px 10px;
        outline: none;
        resize: none;
      }

      li.breadcrumb-item p {
        color: white;
      }
    </style>
  </head>

  <body class="TeacherWanted">
    <!-- 手機板導引列(粗糙) -->
    <header class="TeacherWanted">
      <div id="mySidebar">
        <img src="../img/base/logo.png" alt="" />
        <a href="/index" class="">首頁</a>
        <a href="/courseteacher/CourseVue.html" class="">課程</a>
        <a href="/active/activeIndex.html" class="">活動</a>
        <a href="/wish" class="">許願池</a>
        <a href="/bbsdiscuss/index.html" class="">論壇</a>
        <a href="/baseVer3/homepage.html" class="">商城</a>
      </div>
      <div class="navBar">
        <ul class="containerHearder flexWrap flexVerticalCenter">
          <li>
            <img
              src="../img/base/menu.png"
              id="phoneMenu"
              class="mobileHave"
              style="height: 30px; margin: 10px"
              alt=""
            />
          </li>

          <li
            class="flexWrap flexAllCenter"
            style="font-size: 50px; color: #a4c964; margin: 10px 0px"
          >
            <img
              src="../img/base/logo.png"
              class="miniMobile"
              style="height: 50px; margin: 0px 5px"
              alt=""
            />
            <p>懸賞啼雀</p>
          </li>
          <li
            class="flexWrap"
            style="
              flex-grow: 1;
              display: flex;
              align-items: center;
              justify-content: end;
            "
          >
            <!-- 電腦版導引列 -->
            <div
              id="navLink"
              class="flexWrap flexAllCenter pcHave"
              style="flex-grow: 1"
            >
              <a class="flexAllCenter" href="/index">首頁</a>
              <a class="flexAllCenter" href="/courseteacher/CourseVue.html"
                >課程</a
              >
              <a class="flexAllCenter" href="/active/activeIndex.html">活動</a>
              <a class="flexAllCenter" href="/wish">許願池</a>
              <a class="flexAllCenter" href="/bbsdiscuss/index.html">論壇</a>
              <a class="flexAllCenter" href="/baseVer3/homepage.html">商城</a>
            </div>
            <div
              class="flexWrap flexAllCenter"
              style="position: relative; top: 2px"
            >
              <div class="miniMobile">
                <div id="navSearch" action="">
                  <select id="serchType">
                    <option value="課程">課程</option>
                    <option value="活動">活動</option>
                    <!-- <option value="商城">商城</option>
                  <option value="許願">許願</option> -->
                  </select>
                  <input id="searchText" type="text" />
                  <img id="searchIcon" src="../img/base/search.svg" alt="" />
                </div>
              </div>

              <img
                src="../img/base/bell.svg"
                id="navAnn"
                class="miniMobile"
                style="height: 30px; margin: 3px 5px; cursor: pointer"
                alt=""
              />
              <img
                src="../img/base/mailForNavbar.svg"
                id="navMail"
                class="miniMobile"
                style="
                  height: 30px;
                  margin: 3px 5px;
                  cursor: pointer;
                  position: relative;
                  bottom: 1px;
                "
                alt=""
              />
              <img
                src="../img/base/shoppingCart.svg"
                id="navShoppingcart"
                class="miniMobile"
                style="height: 30px; margin: 3px 5px; cursor: pointer"
                alt=""
              />

              <!--登入按鈕 開始 -->

              <div id="loginOrUser"></div>
              <!-- 登入按鈕 結束 -->
            </div>
          </li>
        </ul>
      </div>
    </header>

    <main class="TeacherWanted">
      <div class="container-fluid">
        <div>
          <nav class="navbar navbar-light bg-light">
            <div class="container-fluid">
              <div class="col-md-1">
                <button
                  type="button"
                  class="btn btn-outline-success bbs_btn_edit"
                >
                  發表文章
                </button>
              </div>
              <div class="col-md-1">
                <button
                  type="button"
                  class="btn btn-outline-success bbs_btn_view"
                >
                  發文紀錄
                </button>
              </div>
              <div class="col-md">
                <button
                  type="button"
                  class="btn btn-outline-success bbs_btn_favorite"
                >
                  我的收藏
                </button>
              </div>
              <!-- <form class="d-flex">
              <input class="form-control me-2" type="search" placeholder="查詢文章請輸入..." aria-label="Search" />
              <button class="btn btn-outline-success" type="submit">
                Search
              </button>
            </form> -->
            </div>
          </nav>
        </div>
        <div class="row">
          <div class="col-md-2 mt-3">
            <!-- 側邊攔 -->
            <div class="list-group" id="list-tab" role="tablist">
              <a
                class="list-group-item list-group-item-action active"
                data-bs-toggle="list"
                href="/bbsdiscuss/index.html?posttype=語言討論版"
                role="tab"
                aria-controls="list-home"
                >語言討論版</a
              >
              <a
                class="list-group-item list-group-item-action"
                data-bs-toggle="list"
                href="/bbsdiscuss/index.html?posttype=程式討論版"
                role="tab"
                aria-controls="list-profile"
                >程式討論版</a
              >
              <a
                class="list-group-item list-group-item-action"
                data-bs-toggle="list"
                href="/bbsdiscuss/index.html?posttype=生活討論版"
                role="tab"
                aria-controls="list-messages"
                >生活討論版</a
              >
              <a
                class="list-group-item list-group-item-action"
                data-bs-toggle="list"
                href="/bbsdiscuss/index.html?posttype=電競討論版"
                role="tab"
                aria-controls="list-settings"
                >電競討論版</a
              >
            </div>
          </div>
          <div class="col-md-10 mt-3">
            <!-- 文章 -->
            <div class="container bbs_bread_list"></div>
            <div class="container w-100 bbs_post_list"></div>
            <!-- 讚/倒讚/收藏 -->
            <div class="container mt-3 mb-3">
              <div class="row bbs_post_up_down_heart_list"></div>
            </div>
            <!-- 對話框 -->
            <div class="container w-100">
              <div class="card bbs_new_msg bbs_comment_wrapper">
                <!-- 頭像/名稱/留言/樓層   -->
                <ul class="bbs_comment_list"></ul>
              </div>
            </div>
            <!-- 打字框 -->
            <div class="container">
              <div class="input-group mb-3 mt-5 bbs_post_pen_group"></div>
            </div>
          </div>
        </div>
      </div>
      <!-- <button class="sent">發送</button> -->
    </main>

    <footer
      class="TeacherWanted"
      style="background-color: #3c6a36; color: white"
    >
      <div
        class="containerFooter flexAllCenter"
        style="box-sizing: border-box; padding-top: 50px"
      >
        <div class="flexWrap">
          <ul class="col_33">
            <li class="flexAllCenter" style="color: #a4c964; font-size: 40px">
              懸賞啼雀
            </li>
            <li
              class="flexAllCenter"
              style="margin: 10px 30px; font-weight: normal"
            >
              現代⼈⽣活步相當緊湊我們的課平台幫助
              ⼈們學並且除了線上課提供了實家的合會⼤了學的⾯向
              課元可提⾼學⽣的學興積性 並促學⽣的⾯發展
            </li>
            <li
              id="imgIcon"
              class="flexVerticalCenter"
              style="margin: 20px 30px"
            >
              <img src="../img/base/facebook.svg" class="imgIntroduce" alt="" />
              <img src="../img/base/twitter.svg" class="imgIntroduce" alt="" />
              <img
                src="../img/base/instagram.svg"
                class="imgIntroduce"
                alt=""
              />
            </li>
          </ul>
          <ul class="col_33 flexHorizontalCenter footerMobile">
            <div style="width: 70%">
              <li
                class="flexAllCenter"
                style="color: #a4c964; font-size: 30px; height: 65px"
              >
                Get In Touch
              </li>
              <div class="" style="height: 250px; font-weight: 400">
                <li class="flexWrap" style="margin-top: 10px">
                  <img
                    src="../img/base/map-marker.svg"
                    style="height: 24px; padding-right: 10px; margin-top: 6px"
                    alt=""
                  />
                  <div>
                    <h3 style="font-size: 1.3rem">地址</h3>
                    <h5 style="font-size: 1rem">台北市中山區南京東路三段</h5>
                  </div>
                </li>

                <li class="flexWrap" style="margin-top: 10px">
                  <img
                    src="../img/base/mail.svg"
                    style="height: 24px; padding-right: 10px; margin-top: 6px"
                    alt=""
                  />
                  <div>
                    <h3 style="font-size: 1.3rem">信箱</h3>
                    <h5 style="font-size: 1rem">a1234567890@gmail.com</h5>
                  </div>
                </li>

                <li class="flexWrap" style="margin-top: 10px">
                  <img
                    src="../img/base/phone.svg"
                    style="height: 24px; padding-right: 10px; margin-top: 6px"
                    alt=""
                  />
                  <div>
                    <h3 style="font-size: 1.3rem">連絡電話</h3>
                    <h5 style="font-size: 1rem">0900123456</h5>
                  </div>
                </li>
              </div>
            </div>
          </ul>
          <ul class="col_33 flexHorizontalCenter footerMobile">
            <div style="width: 40%">
              <li
                class="flexAllCenter"
                style="color: #a4c964; font-size: 30px; height: 65px"
              >
                網站地圖
              </li>
              <div class="webMap">
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="/index">>首頁</a>
                </li>
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="/courseteacher/CourseVue.html"
                    >>課程</a
                  >
                </li>
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="/active/activeIndex.html"
                    >>活動</a
                  >
                </li>
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="/wish">>許願池</a>
                </li>
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="/bbsdiscuss/index.html">>論壇</a>
                </li>
                <li style="margin-top: 5px">
                  <a class="webMapLink" href="/baseVer3/homepage.html">>商城</a>
                </li>
              </div>
            </div>
          </ul>
        </div>
      </div>
    </footer>
    <script>
      $(function () {
        // DOM 載入完成之後
        //================================== 根據文章編號取得文章的數據=====================================
        $.ajax({
          url: "/bbsdiscussGet/favandreaction",
          type: "GET",
          data: {},
          dataType: "json",
          success: function (memberid_favandreaction) {
            let fav = [];
            let reaction = [];

            if (memberid_favandreaction["favoriteArticleList"] != null) {
              fav = memberid_favandreaction["favoriteArticleList"].map(
                (x) => x.bbsPostId
              );
            }

            if (memberid_favandreaction["postReactionList"] != null) {
              reaction = memberid_favandreaction["postReactionList"].map(
                (x) => x.bbsPostId
              );
            }
            $.ajax({
              url: "/bbsdiscussGet/session",
              type: "GET",
              data: {},
              dataType: "json",
              success: function (data_id) {
                //   }
                // });

                $.ajax({
                  url: "/bbsdiscussGet",
                  type: "GET",
                  data: {},
                  dataType: "json",
                  success: function (data0) {
                    console.log(data0);
                    console.log(data0 + "// 根據文章編號取得文章的數據");

                    // 獲取URL參數
                    const urlParams = new URLSearchParams(
                      window.location.search
                    );
                    const bbsPostId = urlParams.get("bbsPostId");
                    console.log(bbsPostId);
                    // 使用迴圈遍歷資料陣列
                    // for (let i = 0; i < data.length; i++) {
                    let data = data0.filter((x) => x.bbsPostId == bbsPostId)[0];
                    let currentBbsPostId = data["bbsPostId"];
                    let postTitle = data["postTitle"];
                    let postContent = data["postContent"];
                    let bbsCategoryName = data["bbsCategoryName"];
                    let bbsTagName = data["bbsTagName"];
                    let memId = data["memId"];
                    let updateTimepost = data["updateTime"];
                    let postDislikes = data["postDislikes"];
                    let postLikes = data["postLikes"];
                    let postStatus = data["postStatus"];
                    let postFav = data["postFav"];

                    // ============= 根據文章id取得文章，大頭貼，tag，文章分類，收藏狀態，按讚狀態=======================
                    $.ajax({
                      url: "/bbsdiscussGetAll",
                      type: "GET",
                      data: { bbsPostId: currentBbsPostId },
                      dataType: "json",
                      beforeSend: function () {},
                      success: function (data2) {
                        console.log(data2);
                        console.log(
                          data2 +
                            "// 根據文章id取得文章，大頭貼，tag，文章分類，收藏狀態，按讚狀態"
                        );
                        let memPhoto =
                          "data:image/" + "null" + ";base64," + data2.memPhoto;
                        let favStatus = data2.favStatus;
                        let reaction_status = data2.reaction_status;
                        let memAccount = data2.memAccount;
                        let memName = data2.memName;
                        //  ========== 依據memId查找會員資料-回傳memName.memPhoto.memAccount-(參考)-post.html or bsdiscusspo.html==============
                        $.ajax({
                          url: "/bbsdiscussGet/memberInfo",
                          type: "GET",
                          dataType: "json",
                          success: function (data3) {
                            console.log(data3);
                            console.log(data3 + "// 依據memId查找會員資料");
                            let sessionName = data3.memName;
                            console.log(sessionName + "是sessionName");
                            //=================根據文章id取得，留言數據=====================================
                            $.ajax({
                              url: "/bbsdiscussGet/comm",
                              type: "GET",
                              data: { bbsPostId: data.bbsPostId },
                              dataType: "json",
                              success: function (data4) {
                                console.log(data4);

                                data4 = data4.sort(function (a, b) {
                                  return b.bbsCommentId - a.bbsCommentId;
                                });

                                console.log(
                                  data4 + "// 根據文章id取得，留言數據"
                                );
                                // 獲取每個資料項目的相關屬性值
                                console.log(currentBbsPostId);
                                console.log(bbsPostId);
                                if (
                                  String(currentBbsPostId) === String(bbsPostId)
                                ) {
                                  // console.log(currentBbsPostId);
                                  // console.log(bbsPostId);
                                  // ======================================論壇>看板>文章=============================================
                                  let bbs_post_topper_html = `
                            <nav style="--bs-breadcrumb-divider: '>'" aria-label="breadcrumb">
                              <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/bbsdiscuss/index.html?posttype=all">論壇</a><p>${bbsPostId}</p></li>
                                <li class="breadcrumb-item">
                                  <a href="#" onclick="go_theme_url(this)" >${bbsCategoryName}</a>
                                </li>
                                <li class="breadcrumb-item active" aria-current="page">${postTitle}</li>
                              </ol>
                            </nav>
                            `;
                                  $("div.bbs_bread_list").append(
                                    bbs_post_topper_html
                                  );
                                  // ======================================發文者資訊及發文內容=============================
                                  let editStr = "";
                                  let editStr1 = "";
                                  let editStr2 = "";

                                  if (String(data_id) === String(memId)) {
                                    editStr =
                                      '<img id="bbs_top_pen_img" class="w-25 col-md-1" src="../img/bbsdiscuss/pen-to-square-solid.svg" alt="編輯" />';
                                    editStr1 = `
                                  <img id="bbs_top_xmark_img" data-bs-toggle="modal" data-bs-target="#${modalIdTop}" class="w-25" src="../img/bbsdiscuss/xmark-solid.svg" alt="刪除" />
                                  <!-- Modal -->
                                  <div class="modal fade" id="${modalIdTop}" tabindex="-1" aria-labelledby="exampleModalLabel"
                                      aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                      <div class="modal-content">
                                        <div class="modal-header">
                                          <h5 class="modal-title" id="exampleModalLabel">是否刪除文章?</h5>
                                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary btn_bbs_cancel1" data-bs-dismiss="modal">
                                            取消
                                          </button>
                                          <button type="submit" class="btn btn-success btn_bbs_sure1">
                                            確定
                                          </button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>`;
                                    editStr2 =
                                      '<img id="bbs_mid_pen_img" class="w-25 col-md-1" src="../img/bbsdiscuss/pen-to-square-solid.svg" alt="編輯" />';
                                  }

                                  let bbs_post_top_html =
                                    `
                            <div class="card">
                              <span id="cardId" style="display: none;">${bbsPostId}</span>
                              <div class="card-body row bbs_post_title_edit_group bbs_post_conent_edit_group">
                                <h1 class="card-title mb-3 col-md-10 bbs_post_title_edit">${postTitle}</h1>
                                <input type="text" class="post_title_update -none" placeholder="編輯文章標題…" value="${postTitle}">
                                <div class="col-md-1 mt-2">` +
                                    editStr +
                                    ` </div>
                                <div class="col-md-1 mt-2 bbs_post_top_xmark">
                                ` +
                                    editStr1 +
                                    `</div>
                                <div class="row mb-3">
                                  <div class="col-md-2  text-muted ">
                                    <h6 class="card-subtitle mb-2 ">${bbsCategoryName}</h6>
                                  </div>
                                  <div class="col-md  text-muted">
                                    <h6 class="card-subtitle mb-2 ">${bbsTagName}</h6>
                                  </div>
                                </div>
                                <div class="row align-items-center mb-3">
                                  <div class="col">
                                    <img src="${memPhoto}" class="img-fluid rounded-start" alt="頭像" />
                                  </div>
                                  <div class="col-11">
                                    <h5 class="card-title text-primary">${memName}</h5>
                                    <h6 class="mb-2">${memAccount}</h6>
                                    <p class="text-muted">樓主 | 發布於 ${updateTimepost}</p>
                                  </div>
                                  <hr />
                                </div>
                                <div class="row">
                                  <div class="col-md-11 mt-2">
                                    <h3 class="card-text bbs_post_content_edit">${postContent}</h3>
                                    <textarea class="post_content_update -none" placeholder="编辑文章内容...">${postContent}</textarea>
                                  </div>
                                  <div class="col-md-1 mt-2">
                                    ` +
                                    editStr2 +
                                    `</div>
                                </div>
                              </div>
                            </div>
                            `;
                                  $("div.bbs_post_list").append(
                                    bbs_post_top_html
                                  );
                                  // ======================================讚/倒讚/收藏==========================================
                                  let reaction_str = check_fav_reaction(
                                    reaction,
                                    bbsPostId,
                                    "reaction",
                                    postLikes
                                  );
                                  let fav_str = check_fav_reaction(
                                    fav,
                                    bbsPostId,
                                    "fav",
                                    postFav
                                  );

                                  let bbs_post_mid_html = `

                                ${reaction_str}

                            <!--        <div class="col-md-1 mx-lg-3">
                              <div class="bbs_thumbs_down_group" style="cursor: pointer">
                                <img id="bbs_thumbs_down_img" class="w-25" src="../img/bbsdiscuss/thumbs-down-regular.svg" alt="倒讚" />
                                <span class="bbs_thumbs_down_count">${postDislikes}</span>
                              </div> -->
                            </div>

                                ${fav_str}
                            `;
                                  $("div.bbs_post_up_down_heart_list").append(
                                    bbs_post_mid_html
                                  );
                                  // ======================================打字框===================================================
                                  let bbs_post_pen_bottom_html = `
                            <input type="text" class="form-control bbs_msg_content" placeholder="留言..."aria-label="Recipient's username" aria-describedby="button-addon2" />
                            <button class="btn btn-outline-success bbs_send_msg" type="button" id="button-addon2">發送</button>
                            `;
                                  $("div.bbs_post_pen_group").append(
                                    bbs_post_pen_bottom_html
                                  );

                                  // =====================================留言區enter送出===================================
                                  $("div.bbs_post_pen_group").on(
                                    "keyup",
                                    ".bbs_msg_content",
                                    function (e) {
                                      if (e.which === 13) {
                                        console.log("enter有觸發嗎?");
                                        $("div.bbs_post_pen_group")
                                          .find(".bbs_send_msg")
                                          .click();
                                        console.log("enter有觸發嗎?");
                                      }
                                    }
                                  );
                                  let modalCounter = 0;
                                  // =====================================留言區請求查詢===================================
                                  for (let j = 0; j < data4.length; j++) {
                                    console.log(data4 + "for迴圈裡面的data4");
                                    console.log(data4[j]["bbsCommentId"]);
                                    let bbsCommentId = data4[j]["bbsCommentId"];
                                    if (bbsCommentId != null) {
                                      let bbsPostIdcomm = data4[j].bbsPostId;
                                      let commentContent =
                                        data4[j].commentContent;
                                      let commentStatus =
                                        data4[j].commentStatus;
                                      let createTimecomm = data4[j].createTime;
                                      let memIdcomm = data4[j].memId;
                                      let updateTime = data4[j].updateTime;
                                      let count = 0;
                                      count++;
                                      let modalId =
                                        "exampleModal" + modalCounter;
                                      modalCounter++;
                                      //=================//  根據留言id取得，大頭貼=====================================
                                      $.ajax({
                                        url: "/bbsdiscussGet/commInfo",
                                        type: "GET",
                                        data: { bbsCommentId: bbsCommentId },
                                        dataType: "json",
                                        success: function (data5) {
                                          console.log(
                                            data5 +
                                              "data5 //  根據留言id取得，大頭貼"
                                          );
                                          console.log(data5);
                                          let memNamecomm5 = data5.memName;
                                          let memPhotocomm5 =
                                            "data:image/" +
                                            "null" +
                                            ";base64," +
                                            data5.memPhoto;

                                          let editStr3 = "";
                                          let editStr4 = "";

                                          console.log(String(data_id));
                                          console.log(memIdcomm);

                                          if (
                                            String(data_id) ===
                                            String(memIdcomm)
                                          ) {
                                            editStr3 = ` <img id="bbs_pen_img" class="w-25" src="../img/bbsdiscuss/pen-to-square-solid.svg" alt="編輯" onClick="bbs_pen(this,${data4[j]["bbsCommentId"]})" />`;
                                            editStr4 = ` <img id="bbs_xmark_img" data-bs-toggle="modal" data-bs-target="#${modalId}_comm" class="w-25" src="../img/bbsdiscuss/xmark-solid.svg" alt="刪除" />
                                          <!-- Modal -->
                                          <div class="modal fade" id="${modalId}_comm" tabindex="-1" aria-labelledby="exampleModalLabel"
                                              aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                              <div class="modal-content">
                                                <div class="modal-header">
                                                  <h5 class="modal-title" id="exampleModalLabel">是否刪除留言?</h5>
                                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-footer">
                                                  <button type="button" class="btn btn-secondary btn_bbs_cancel1" data-bs-dismiss="modal">
                                                    取消
                                                  </button>
                                                  <button type="submit" class="btn btn-success btn_bbs_sure2">
                                                    確定
                                                  </button>
                                                </div>
                                              </div>
                                            </div>
                                          </div>`;
                                          }

                                          let bbs_msg_content_html_first = `
                                          <li>
                                            <div class="card-body comment">
                                              <div class="row">
                                                <div class="col-md-1">
                                                  <img src=${memPhotocomm5} class="img-fluid rounded-start" alt="頭像" />
                                                </div>
                                                <div class="col-md-6">
                                                  <h5 id="bbs_title_test" class="card-title">${memNamecomm5}</h5>
                                                  <h6 id="bbs_title_test2" class="card-subtitle mb-2 mt-2 text-muted bbs_pare">
                                                    ${commentContent}
                                                  </h6>
                                                  <input type="text" class="task_name_update -none" placeholder="編輯留言…" value="${commentContent}">
                                                </div>
                                                <div class="col-md-3 mt-2">
                                                  <h6 class="card-subtitle mb-2 text-muted">
                                                    ${updateTime} 回覆
                                                  </h6>
                                                  <h6 class="card-subtitle mb-2 text-muted mt-2">
                                                     第 ${bbsCommentId} 樓
                                                  </h6>
                                                </div>
                                                <div class="col-md-1 mt-2">
                                                      ${editStr3}
                                                      </div>
                                                <div class="col-md-1 mt-2">
                                                     ${editStr4}
                                                </div>
                                              </div>
                                            </div>
                                          </li>
                                          `;
                                          $("ul.bbs_comment_list").append(
                                            bbs_msg_content_html_first
                                          );

                                          //=====================================留言區按鈕送出留言======================
                                          $("div.bbs_post_pen_group").on(
                                            "click",
                                            ".bbs_send_msg",
                                            function () {
                                              let count = 0;
                                              count++;
                                              let modalId =
                                                "exampleModal" + modalCounter;
                                              modalCounter++;
                                              let bbs_msg_content_trim = $(
                                                ".bbs_msg_content"
                                              )
                                                .val()
                                                .trim();
                                              console.log(bbs_msg_content_trim);
                                              if (bbs_msg_content_trim != "") {
                                                $(".bbs_msg_content").val("");
                                              }
                                            }
                                          );
                                        },
                                      });
                                    }
                                    // =====================================下一位==================================
                                  }
                                }
                              },
                            });
                          },
                        });
                      },
                    });
                    // }
                  },
                });
              },
            });
          },
        });
        // =============================================文章內容=================================================================
        // 唯一ID的計數器
        let modalCounterTop = 0;
        let modalIdTop = "exampleModal" + modalCounterTop;
        modalCounterTop++;
        // 唯一ID的計數器
        let modalCounterMid = 0;
        let modalIdMid = "exampleModal" + modalCounterMid;
        modalCounterMid++;

        // ==========================================刪除文章==================================================================
        $("div.bbs_post_list").on("click", "#bbs_top_xmark_img", function () {
          //按確定後刪除文章
          $("div.bbs_post_list").on("click", ".btn_bbs_sure1", function () {
            $("main").hide();
            window.location.href = "/bbsdiscuss/index.html?posttype=all";
            const urlParams = new URLSearchParams(window.location.search);
            const bbsPostId = urlParams.get("bbsPostId");
            console.log(bbsPostId);
            let json_data_bbspost_status = {
              postStatus: 0,
            };
            $.ajax({
              url: "/bbsdiscussGet/bbspoststatus/" + bbsPostId, // 資料請求的網址
              type: "PUT", // GET | POST | PUT | DELETE | PATCH
              data: JSON.stringify(json_data_bbspost_status),
              dataType: "json",
              contentType: "application/json",
              beforeSend: function () {},
              success: function (data9) {
                console.log("data9文章刪除成功了999999999");
                console.log(data8);
                $(".bbs_msg_content").val(""); // 清空输入框的值
                location.reload(); // 刷新页面
              },
              error: function (xhr) {
                console.log("data9文章刪除失敗了了GGGGGGG");
                console.log(xhr);
              },
              complete: function (xhr) {
                // window.location.href = "index.html";
              },
            });
          });
        });
        // =====================================編輯文章標題==============================================================
        $("div.bbs_post_list").on("click", "#bbs_top_pen_img", function () {
          // console.log("aaa");
          // console.log(this);

          let post_title_update = "";
          if ($(this).attr("data-edit") == undefined) {
            // 進入編輯狀態

            $(this).attr("data-edit", true);
            $("div.bbs_post_title_edit_group")
              .find("h1.bbs_post_title_edit")
              .toggleClass("-none");
            $("div.bbs_post_title_edit_group")
              .find("input.post_title_update")
              .toggleClass("-none");
          } else {
            post_title_update = $("div.bbs_post_title_edit_group")
              .find("input.post_title_update")
              .val()
              .trim();
            $("div.bbs_post_title_edit_group")
              .find("h1.bbs_post_title_edit")
              .html(post_title_update)
              .toggleClass("-none");
            $("div.bbs_post_title_edit_group")
              .find("input.post_title_update")
              .val(post_title_update)
              .toggleClass("-none");
            $("div.bbs_post_title_edit_group").removeAttr("data-edit");
          }

          let preEelemnt =
            this.parentNode.previousElementSibling.classList.contains("-none");
          let will_sav_title = preEelemnt;

          if (will_sav_title) {
            let post_id = document.getElementById("cardId").textContent;
            alert(
              `要儲存tiltle了 , title標題:${post_title_update} , postId:${post_id}`
            );
            let jason_data_title_update = {
              postTitle: post_title_update,
            };
            $.ajax({
              url: "/bbsdiscussGet/title/" + post_id,
              type: "PUT",
              data: JSON.stringify(jason_data_title_update),
              dataType: "json",
              contentType: "application/json",
              success: function (data_title_update) {
                console.log(data_title_update);
              },
            });
            //  console.log('要儲存tile了')
          }
        });
        // =====================================編輯文章內容=============================================================
        $("div.bbs_post_list").on("click", "#bbs_mid_pen_img", function () {
          // console.log("aaa");
          // console.log(this);
          if ($(this).attr("data-edit") == undefined) {
            // 進入編輯狀態

            $(this).attr("data-edit", true);
            $("div.bbs_post_conent_edit_group")
              .find("h3.bbs_post_content_edit")
              .toggleClass("-none");
            $("div.bbs_post_conent_edit_group")
              .find("textarea.post_content_update")
              .toggleClass("-none");
          } else {
            let post_content_update = $("div.bbs_post_conent_edit_group")
              .find("textarea.post_content_update")
              .val()
              .trim();

            $("div.bbs_post_conent_edit_group")
              .find("h3.bbs_post_content_edit")
              .html(post_content_update)
              .toggleClass("-none");
            $("div.bbs_post_conent_edit_group")
              .find("textarea.post_content_update")
              .val(post_content_update)
              .toggleClass("-none");
            $("div.bbs_post_conent_edit_group").removeAttr("data-edit");
          }

          let preEelemnt =
            this.parentNode.previousElementSibling.children[1].classList.contains(
              "-none"
            );
          let will_sav_content = preEelemnt;

          if (will_sav_content) {
            let post_id = document.getElementById("cardId").textContent;
            let post_content_update =
              this.parentNode.previousElementSibling.children[0].textContent;

            alert(
              `要儲存content了 內容:${post_content_update} , postId:${post_id}`
            );
            let jason_data_content_update = {
              postContent: post_content_update,
            };
            $.ajax({
              url: "/bbsdiscussGet/content/" + post_id,
              type: "PUT",
              data: JSON.stringify(jason_data_content_update),
              dataType: "json",
              contentType: "application/json",
              success: function (data_content_update) {
                console.log(data_content_update);
              },
            });
          }
        });

        // ======================================打字框====================================================================
        // let bbs_post_pen_bottom_html = `
        // <input type="text" class="form-control bbs_msg_content" placeholder="留言..."aria-label="Recipient's username" aria-describedby="button-addon2" />
        // <button class="btn btn-outline-success bbs_send_msg" type="button" id="button-addon2">發送</button>
        // `;
        // $("div.bbs_post_pen_group").append(bbs_post_pen_bottom_html);
        // =======================================留言區/按enter===========================================================
        // $("div.bbs_post_pen_group").on(
        //   "keyup",
        //   ".bbs_msg_content",
        //   function (e) {
        //     if (e.which === 13) {
        //       console.log("enter有觸發嗎?");
        //       $("div.bbs_post_pen_group").find(".bbs_send_msg").click();
        //       console.log("enter有觸發嗎?");
        //     }
        //   }
        // );
        // ==============================請求留言區==================================================================
        // $.ajax({
        //   url: "/bbsdiscussGet/memberInfo",
        //   type: "GET",
        //   dataType: "json",
        //   success: function (data3) {
        //     console.log("有抓到使用者嗎?");
        //     console.log(data3);
        //     // console.log("有留言嗎");
        //     // console.log(data);
        //   },
        // });
        // $.ajax({
        //   url: "/bbsdiscussGet/comm",
        //   type: "GET",
        //   data: { bbsPostId: data.bbsPostId },
        //   dataType: "json",
        //   success: function (data4) {
        //     console.log("有留言數據嗎?");
        //     console.log(data4);
        //     // console.log("有留言嗎");
        //     // console.log(data);
        //   },
        // });
        // =======================================留言區/按發送=============================================================
        // 唯一ID的計數器
        // let modalCounter = 0;
        // $("div.bbs_post_pen_group").on("click", ".bbs_send_msg", function () {
        //   let count = 0;
        //   count++;

        //   let modalId = "exampleModal" + modalCounter;
        //   modalCounter++;

        //   let bbs_msg_content_trim = $(".bbs_msg_content").val().trim();
        //   // console.log(text);
        //   if (bbs_msg_content_trim != "") {
        //     let bbs_msg_content_html = `
        //     <li>
        //       <div class="card-body comment">
        //         <div class="row">
        //           <div class="col-md-1">
        //             <img src=${bbs_post_msg_pic} class="img-fluid rounded-start" alt="頭像" />
        //           </div>
        //           <div class="col-md-7">
        //             <h5 id="bbs_title_test" class="card-title">${bbs_post_msg_people}</h5>
        //             <h6 id="bbs_title_test2" class="card-subtitle mb-2 text-muted bbs_pare">
        //               ${bbs_msg_content_trim}
        //             </h6>
        //             <input type="text" class="task_name_update -none" placeholder="編輯留言…" value="${bbs_msg_content_trim}">
        //           </div>
        //           <div class="col-md-2 mt-2">
        //             <h6 class="card-subtitle mb-2 text-muted">B${bbs_post_msg_floor}</h6>
        //             <h6 class="card-subtitle mb-2 text-muted">
        //               ${bbs_post_msg_time} 回覆
        //             </h6>
        //           </div>
        //           <div class="col-md-1 mt-2">
        //             <img id="bbs_pen_img" class="w-25" src="../img/bbsdiscuss/pen-to-square-solid.svg" alt="編輯" />
        //           </div>
        //           <div class="col-md-1 mt-2">
        //             <img id="bbs_xmark_img" data-bs-toggle="modal" data-bs-target="#${modalId}" class="w-25" src="../img/bbsdiscuss/xmark-solid.svg" alt="刪除" />
        //             <!-- Modal -->
        //             <div class="modal fade" id="${modalId}" tabindex="-1" aria-labelledby="exampleModalLabel"
        //                 aria-hidden="true">
        //               <div class="modal-dialog modal-dialog-centered">
        //                 <div class="modal-content">
        //                   <div class="modal-header">
        //                     <h5 class="modal-title" id="exampleModalLabel">是否刪除留言?</h5>
        //                     <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        //                   </div>
        //                   <div class="modal-footer">
        //                     <button type="button" class="btn btn-secondary btn_bbs_cancel1" data-bs-dismiss="modal">
        //                       取消
        //                     </button>
        //                     <button type="submit" class="btn btn-success btn_bbs_sure2">
        //                       確定
        //                     </button>
        //                   </div>
        //                 </div>
        //               </div>
        //             </div>
        //           </div>
        //         </div>
        //       </div>
        //     </li>
        //     `;
        //     // $("ul.bbs_comment_list").append(bbs_msg_content_html);
        //     $(".bbs_msg_content").val("");
        //   }
        // });
        //=====================================留言區按鈕送出留言======================
        const urlParams = new URLSearchParams(window.location.search);
        const bbsPostId = urlParams.get("bbsPostId");
        console.log(bbsPostId);
        let modalCounter = 0;
        $("div.bbs_post_pen_group").on("click", ".bbs_send_msg", function () {
          const urlParams = new URLSearchParams(window.location.search);
          const bbsPostId = urlParams.get("bbsPostId");
          console.log(bbsPostId);
          let count = 0;
          count++;
          let modalId = "exampleModal" + modalCounter;
          modalCounter++;
          let bbs_msg_content_trim = $(".bbs_msg_content").val().trim();
          console.log(bbs_msg_content_trim);
          let json_data_comm = {
            commentContent: bbs_msg_content_trim,
            bbsPostId: bbsPostId,
          };
          $.ajax({
            url: "/bbsdiscussGet/newcomm", // 資料請求的網址
            type: "POST", // GET | POST | PUT | DELETE | PATCH
            data: JSON.stringify(json_data_comm),
            dataType: "json",
            contentType: "application/json",
            beforeSend: function () {},
            success: function (data7) {
              console.log("data7成功了777777777");
              console.log(data7);
              $(".bbs_msg_content").val(""); // 清空输入框的值
              location.reload(); // 刷新頁面
            },
            error: function (xhr) {
              console.log("data7失敗了了GGGGGGG");
              console.log(xhr);
            },
            complete: function (xhr) {
              // window.location.href = "index.html";
            },
          });
        });
        // ==========================================刪除留言==========================================================
        $(".bbs_comment_list").on("click", "#bbs_xmark_img", function () {
          console.log(this);
          let bbsCommentId = $(this)
            .parent("div")
            .parent("div.row")
            .find(".bbsCommentId")
            .text();
          console.log("-----------------------------bbsCommentId:");
          console.log(bbsCommentId);
          console.log("有bbsCommentId嗎??????????bbsCommentId");
          //按確定後刪除留言
          $(".bbs_comment_list").on("click", ".btn_bbs_sure2", function () {
            console.log(this);
            $(this).closest("li").fadeOut(1000);
            // 淡出效果完成後關閉燈箱效果
            $(this).closest(".modal").modal("hide");
            // 使用jQuery的text()方法

            let json_data_comm_status = {
              bbsCommentId: bbsCommentId,
              commentStatus: 0,
            };
            $.ajax({
              url: "/bbsdiscussGet/bbscommstatus", // 資料請求的網址
              type: "PUT", // GET | POST | PUT | DELETE | PATCH
              data: JSON.stringify(json_data_comm_status),
              dataType: "json",
              contentType: "application/json",
              beforeSend: function () {},
              success: function (data8) {
                console.log("data8成功了888888888888");
                console.log(data8);
                location.reload(); // 刷新页面
              },
              error: function (xhr) {
                console.log("data8失敗了了GGGGGGG");
                console.log(xhr);
              },
              complete: function (xhr) {
                // window.location.href = "index.html";
              },
            });
          });
        });

        //==========================跳轉到發文紀錄====================================================
        $(".bbs_btn_view").on("click", function () {
          window.location.href = "bsdiscusspo.html";
        });
        //==========================跳轉到發表文章====================================================
        $(".bbs_btn_edit").on("click", function () {
          window.location.href = "edit.html";
        });
        //==========================跳轉到我的收藏===================================================
        $(".bbs_btn_favorite").on("click", function () {
          window.location.href = "heart.html";
        });
        // ============================按讚======================================================================
        // $("div.bbs_post_up_down_heart_list").on(
        //   "click",
        //   "#bbs_thumbs_up_img",
        //   function () {
        //     let img_element = $(this);
        //     let current_src = img_element.attr("src");
        //     let solid_src = "img/bbsdiscuss/thumbs-up-solid.svg";
        //     let regular_src = "img/bbsdiscuss/thumbs-up-regular.svg";

        //     if (current_src === regular_src) {
        //       img_element.attr("src", solid_src);
        //       bbs_post_up++; // 讚的數量加1
        //       console.log(bbs_post_up);
        //     } else if (current_src === solid_src) {
        //       img_element.attr("src", regular_src);
        //       bbs_post_up--; // 讚的數量减1
        //       console.log(bbs_post_up);
        //     }
        //     // 更新讚的數量
        //     img_element.siblings(".bbs_thumbs_up_count").text(bbs_post_up);
        //   }
        // );
        // ============================倒讚======================================================================
        $("div.bbs_post_up_down_heart_list").on(
          "click",
          "#bbs_thumbs_down_img",
          function () {
            let img_element = $(this);
            let current_src = img_element.attr("src");
            let solid_src = "img/bbsdiscuss/thumbs-down-solid.svg";
            let regular_src = "img/bbsdiscuss/thumbs-down-regular.svg";

            if (current_src === regular_src) {
              img_element.attr("src", solid_src);
              bbs_post_down++; // 倒讚的數量加1
              console.log(bbs_post_down);
            } else if (current_src === solid_src) {
              img_element.attr("src", regular_src);
              bbs_post_down--; // 倒讚的數量减1
              console.log(bbs_post_down);
            }
            // 更新倒讚的數量
            img_element.siblings(".bbs_thumbs_down_count").text(bbs_post_down);
          }
        );

        // // ============================收藏====================================================================
        // $("div.bbs_post_up_down_heart_list").on(
        //   "click",
        //   "#bbs_heart_img",
        //   function () {
        //     let img_element = $(this);
        //     let current_src = img_element.attr("src");
        //     let solid_src = "img/bbsdiscuss/heart-solid.svg";
        //     let regular_src = "img/bbsdiscuss/heart-regular.svg";

        //     if (current_src === regular_src) {
        //       img_element.attr("src", solid_src);
        //       bbs_post_heart++; // 收藏的數量加1
        //       console.log(bbs_post_heart);
        //     } else if (current_src === solid_src) {
        //       img_element.attr("src", regular_src);
        //       bbs_post_heart--; // 收藏的數量减1
        //       console.log(bbs_post_heart);
        //     }
        //     // 更新收藏的數量
        //     img_element.siblings(".bbs_heart_count").text(bbs_post_heart);
        //   }
        // );
      });

      // let bbs_fav = {
      //   bbsPostId: 1,
      //   favStatus: 1,
      // };
      $("div.bbs_post_up_down_heart_list").on(
        "click",
        "#bbs_heart_img",
        function () {
          console.log("愛心~~~!!!");
          $.ajax({
            url: "/bbsdiscussGet/favStstatus",
            type: "POST",
            data: {},
            dataType: "json",
            success: function (data) {
              console.log(data);
            },
          });
        }
      );

      //========================================新增留言============================================
      // $(".sent").on("click", function () {
      //   console.log("有新增留言的觸發嗎");
      //   // 獲取 <p> 標籤裡 postId的值
      //   var textContent = $("p").text();
      //   console.log(
      //     "p標籤得值~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
      //   );
      //   console.log(textContent);

      //   let json_data_comm = {
      //     commentContent: discuss_dr_value,
      //     bbsPostId: textContent,
      //   };
      //   $.ajax({
      //     url: "/bbsdiscussGet/newcomm", // 資料請求的網址
      //     type: "POST", // GET | POST | PUT | DELETE | PATCH
      //     data: JSON.stringify(json_data_comm),
      //     dataType: "json",
      //     contentType: "application/json",
      //     beforeSend: function () {},
      //     success: function (data) {
      //       console.log(data);
      //     },
      //     error: function (xhr) {
      //       console.log("error");
      //       console.log(xhr);
      //     },
      //     complete: function (xhr) {
      //       // window.location.href = "index.html";
      //     },
      //   });
      // });
      //======================================新增留言==========================================

      //======================================導到指定網頁主題==========================================
      function go_theme_url(event) {
        let type_content = event.textContent;
        console.log(type_content);
        let type_theme = get_url_theme_type(type_content);
        let url = `/bbsdiscuss/index.html?posttype=${type_content}`;

        window.location.href = url;
      }

      function get_url_theme_type(type) {
        switch (type) {
          case "語言討論版":
          case "程式討論版":
          case "生活討論版":
          case "電競討論版":
            return "lg";
          default:
            aler("未設定的討論版");
            break;
        }
      }

      // ============================讚======================================================================

      async function lik(element, event) {
        // console.log(`postId : ${element}`);
        // console.log(event);

        let like_type;

        let img_element = event.querySelector("img");
        let current_src = img_element.getAttribute("src");
        let solid_src = "/img/bbsdiscuss/thumbs-up-solid.svg";
        let regular_src = "/img/bbsdiscuss/thumbs-up-regular.svg";

        let nextElement = img_element.nextElementSibling;
        let domValue = nextElement.textContent;

        console.log(current_src);
        console.log(regular_src);
        console.log(solid_src);
        if (current_src === regular_src) {
          // 讚
          like_type = 1;
          img_element.src = solid_src;

          let parentElement = img_element.parentNode.parentNode;
          parentElement.className += " btn-primary text-white";
        } else if (current_src === solid_src) {
          // 取消讚
          like_type = 0;
          img_element.src = regular_src;
          let parentElement = img_element.parentNode.parentNode;
          parentElement.classList.remove("btn-primary", "text-white");
        }
        let img_elements = event.querySelector("img");
        let current_src2 = img_element.getAttribute("src");

        // 更新收藏的數量
        json_data = {
          bbsPostId: element,
          reactionStatus: like_type,
        };
        let result_lik = await my_ajax(
          "/bbsdiscussGet/reactionstatus",
          "POST",
          JSON.stringify(json_data)
        );
        // console.log(result_lik);
        let span = event.querySelector("span");
        // console.log(h6)

        span.textContent = result_lik;
      }

      // =================按下收藏====================
      async function fav(element, event) {
        // $("div.bbs_post_up_down_heart_list").on(
        //   "click",
        //   "#bbs_heart_img",
        //   function () {
        //     let img_element = $(this);
        //     let current_src = img_element.attr("src");
        //     let solid_src = "img/bbsdiscuss/heart-solid.svg";
        //     let regular_src = "img/bbsdiscuss/heart-regular.svg";

        //     if (current_src === regular_src) {
        //       img_element.attr("src", solid_src);
        //       bbs_post_heart++; // 收藏的數量加1
        //       console.log(bbs_post_heart);
        //     } else if (current_src === solid_src) {
        //       img_element.attr("src", regular_src);
        //       bbs_post_heart--; // 收藏的數量减1
        //       console.log(bbs_post_heart);
        //     }
        //     // 更新收藏的數量
        //     img_element.siblings(".bbs_heart_count").text(bbs_post_heart);
        //   }
        // );

        console.log(`postId : ${element}`);
        console.log(event);

        let like_type;

        let img_element = event.querySelector("img");
        let current_src = img_element.getAttribute("src");
        let solid_src = "/img/bbsdiscuss/heart-solid.svg";
        let regular_src = "/img/bbsdiscuss/heart-regular.svg";

        let nextElement = img_element.nextElementSibling;
        let domValue = nextElement.textContent;

        console.log(regular_src);
        console.log(current_src);
        console.log(solid_src);

        if (current_src === regular_src) {
          // 收藏
          like_type = 1;
          img_element.src = solid_src;

          let parentElement = img_element.parentNode.parentNode;
          parentElement.className += " btn-danger text-white";
        } else if (current_src === solid_src) {
          // 取消收藏
          like_type = 0;
          img_element.src = regular_src;
          let parentElement = img_element.parentNode.parentNode;
          parentElement.classList.remove("btn-danger", "text-white");
        }
        let img_elements = event.querySelector("img");
        let current_src2 = img_element.getAttribute("src");

        // 更新收藏的數量
        json_data = {
          bbsPostId: element,
          favStatus: like_type,
        };
        let result_fav = await my_ajax(
          "/bbsdiscussGet/favStstatus",
          "POST",
          JSON.stringify(json_data)
        );
        // console.log(result_fav);
        let span = event.querySelector("span");
        // console.log(h6)

        span.textContent = result_fav;
      }

      function my_ajax(url, type, json_data) {
        // console.log(`use my_ajax
        //              url: ${url}
        //              type: ${type}
        //              json_data: ${json_data}`)
        return new Promise((resolve, reject) => {
          $.ajax({
            url: url, // 資料請求的網址
            type: type, // GET | POST | PUT | DELETE | PATCH
            data: json_data,
            dataType: "json",
            contentType: "application/json",
            beforeSend: function () {},
            success: function (data) {
              // console.log(`response_data: ${data}`);
              resolve(data);
            },
            error: function (xhr) {
              console.log("error");
              console.log(xhr);
            },
            complete: function (xhr) {
              // window.location.href = "index.html";
            },
          });
        });
      }

      // =============================================確認該會員是否曾經按過收藏或讚UI需做對應顯示===================================================
      function check_fav_reaction(list, postid, type, fav_reaction_count) {
        let result = false;

        if (list.indexOf(Number(postid)) > -1) {
          result = true;
        }

        // console.log(`------------------------`)

        // console.log(list)
        // console.log(`postid=> ${postid} `)
        // console.log(`${type} 結果 => ${result}`)
        // console.log(`------------------------`)

        switch (type) {
          case "fav":
            let str_fav = "";

            if (result) {
              str_fav = `<div class="col-md-1 mx-lg-3 btn-danger text-white">
                             <div class="bbs_heart_group" style="cursor: pointer" onclick="fav(${postid} , this)">
                                <img id="bbs_heart_img" class="w-25" src="/img/bbsdiscuss/heart-solid.svg" alt="收藏">
                                <span class="bbs_heart_count">${fav_reaction_count}</span>
                             </div>
               </div>`;
            } else {
              str_fav = `<div class="col-md-1 mx-lg-3">
                             <div class="bbs_heart_group" style="cursor: pointer" onclick="fav(${postid} , this)">
                                <img id="bbs_heart_img" class="w-25" src="/img/bbsdiscuss/heart-regular.svg" alt="收藏">
                                <span class="bbs_heart_count">${fav_reaction_count}</span>
                             </div>
                      </div>`;
            }

            return str_fav;

          case "reaction":
            let str_reaction = "";

            if (result) {
              str_reaction = `<div class="col-md-1 mx-lg-3 btn-primary text-white">
                              <div class="bbs_thumbs_up_group" style="cursor: pointer" onclick="lik(${postid} , this)">
                                <img id="bbs_thumbs_up_img" class="w-25" src="/img/bbsdiscuss/thumbs-up-solid.svg" alt="讚">
                                 <span class="bbs_thumbs_up_count">${fav_reaction_count}</span> 
                              </div>
                            </div>`;
            } else {
              str_reaction = `
                            <div class="col-md-1 mx-lg-3">
                               <div class="bbs_thumbs_up_group" style="cursor: pointer" onclick="lik(${postid} , this)">
                                <img id="bbs_thumbs_up_img" class="w-25" src="/img/bbsdiscuss/thumbs-up-regular.svg" alt="讚">
                                 <span class="bbs_thumbs_up_count">${fav_reaction_count}</span> 
                               </div>
                            </div>`;
            }

            return str_reaction;

          default:
            console.log("無判斷類別");
            break;
        }
      }

      // =====================================編輯留言==============================================================
      function bbs_pen(event, bbsCommentId) {
        //  $(".bbs_comment_list").on("click", "#bbs_pen_img", function () {
        // console.log("aaa");
        console.log(event);
        if ($(event).attr("data-edit") == undefined) {
          // 進入編輯狀態

          $(event).attr("data-edit", true);
          $(event).closest("li").find("h6.bbs_pare").toggleClass("-none");
          $(event)
            .closest("li")
            .find("input.task_name_update")
            .toggleClass("-none");
        } else {
          let update_task_name = $(event)
            .closest("li")
            .find("input.task_name_update")
            .val()
            .trim();

          $(event)
            .closest("li")
            .find("h6.bbs_pare")
            .html(update_task_name)
            .toggleClass("-none");
          $(event)
            .closest("li")
            .find("input.task_name_update")
            .val(update_task_name)
            .toggleClass("-none");
          $(event).removeAttr("data-edit");
        }

        let will_sav_bbsComment = !event.hasAttribute("data-edit");

        if (will_sav_bbsComment) {
          let post_id = document.getElementById("cardId").textContent;
          let post_bbsComment_update =
            document.getElementById("bbs_title_test2").textContent;

          alert(
            `要儲存comm留言了 內容:${post_bbsComment_update} , postId:${post_id} , bbsCommentId: ${bbsCommentId}`
          );
          let jason_data_content_update = {
            postContent: post_bbsComment_update,
          };
          $.ajax({
            url: "/bbsdiscussGet/content/" + post_id,
            type: "PUT",
            data: JSON.stringify(jason_data_content_update),
            dataType: "json",
            contentType: "application/json",
            success: function (data_content_update) {
              console.log(data_content_update);
            },
          });
        }
      }
    </script>
  </body>
</html>
